#' Attach taxonomy data to an input table
#'
#' @param input a data.frame
#' @param accessionTaxa_path the path to an accessionTaxa sql
#' @return the data.frame with taxonomy data
#' @export
get_taxonomizr_from_accession <- function(input, accessionTaxa_path) {
    input_taxids <- taxonomizr::accessionToTaxa(input$accession,
                                            accessionTaxa_path)
    ## MonchoÂ´s suggestion to make this less redundant
    ## input %>% mutate(taxid = input_taxids) -> output
    ## input_taxids <- distinct(input_taxids)

    input_taxonomy <- taxonomizr::getTaxonomy(input_taxids, accessionTaxa_path,
                                desiredTaxa = c("species", "superkingdom",
                                "kingdom", "phylum", "subphylum", "superclass",
                                "class", "subclass", "order", "family",
                                "subfamily", "genus", "infraorder", "subcohort",
                                "superorder", "superfamily", "tribe",
                                "subspecies", "subgenus", "species group",
                                "parvorder", "varietas"))

    output <- dplyr::mutate(input, taxid = input_taxids, data.frame(input_taxonomy))

    ## And then instead of the line above

    # output <- tibble(taxid = input_taxids,
    #                   data.frame(input_taxonomy)) %>%
    #            left_join(output, by = taxid)

    # Use mutate to add colummns because it already (correctly) assumed that
    # that stuff would be in the right order and mutate uses memory well.
    return(output)
}
